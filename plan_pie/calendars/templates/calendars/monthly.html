{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container-event">
    <!-- Í≥µÌÜµ Ìó§Îçî Ìè¨Ìï® -->
    <div class="event-header">
        <div class="event-header-left">
            <div id="calThemContainer" class="calThemContainer">
                <!-- ÌñÑÎ≤ÑÍ±∞ Î≤ÑÌäº -->
                <div class="dropdown">
                    <button id="calThem" class="calThem">
                        ‚ò∞
                    </button>
                    <ul class="calList">
                        <!-- Ìï≠Î™©ÏùÄ JSÎ°ú ÏÉùÏÑ±Îê® -->

                        <!-- ÎßàÏßÄÎßâ: Îã¨Î†• Ï∂îÍ∞Ä Î≤ÑÌäº -->
                        <li id="btnAddCal" class="calAddItem">
                            <div class="calImage">
                                <span class="plus">+</span>
                            </div>
                            <div class="calTitle">Add Calendar</div>
                        </li>
                    </ul>
                    
                </div>
            </div>
            <div class="logoTitle">
                <img src="/static/image/pie-log-con.png" alt="Plan Pie Î°úÍ≥†" style="max-width: 80px; height: auto;" >
            </div>
              
            <!-- ÏôºÏ™Ω: Ïó∞ÎèÑ Î∞è Ï¢åÏö∞ Î≤ÑÌäº -->

            {% if calendars %}
                <!-- Îã¨Î†• Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏùÑ Í≤ΩÏö∞ -->
                <div class="calendar-header">
                    <button id="prev"><i data-lucide="chevron-left" class="icon"></i></button>
                    <button id="next"><i data-lucide="chevron-right" class="icon"></i></button>
                    <div class="calendar-ym"></div>
                </div>
            {% endif %}

            
        </div>
    
        <!-- Í∞ÄÏö¥Îç∞ -->
        <div class="event-header-center">
            {% if calendars %}
            <div class="calendar-tab">
                <a href="#" class="tab-link active-tab" data-url="/event/monthly" data-title="Monthly">Monthly</a>
                <a href="#" class="tab-link" data-url="/event/weekly" data-title="Weekly">Weekly</a>
                <a href="#" class="tab-link" data-url="/event/daily" data-title="Daily">Daily</a>
            </div>
            {% endif %}
        </div>
        
    
        
        <!-- Ïò§Î•∏Ï™Ω: ÏÇ¨Ïö©Ïûê ÌîÑÎ°úÌïÑ Î∞è + Î≤ÑÌäº -->
        <div class="event-header-right">
            <div>
                {% if calendars %}
                <button id="toggleEvent" class="btnDefaultQuad">+</button>
                {% endif %}
            </div>
    
            <div>
                <img src="{% if user.profileimage %}{{ user.profileimage.url }}{% else %}{% static 'image/user.png' %}{% endif %}" id="profile" alt="ÌîÑÎ°úÌïÑ" class="profile-rounded">
                <div class="profile-card" id="profileCard">
                    <div class="profile-card-header">
                      <div class="settings-icon" title="ÏÑ§Ï†ï" id="settingsBtn">‚öôÔ∏è</div>
                      <div class="settings-dropdown" id="settingsDropdown">
                        <ul>
                            <li><a href="#" data-modal="modalProfileEdit">ÌîÑÎ°úÌïÑ ÏàòÏ†ï</a></li>
                            <li><a href="#">ÏïåÎ¶º ÏÑ§Ï†ï</a></li>
                            <li><a href="#">Í∞úÏù∏Ï†ïÎ≥¥ ÏÑ§Ï†ï</a></li>
                            <li><a href="#" onclick="event.preventDefault(); document.getElementById('logout-form').submit();">Î°úÍ∑∏ÏïÑÏõÉ</a></li>

                            <!-- Ïà®Í≤®ÏßÑ Î°úÍ∑∏ÏïÑÏõÉ Ìèº -->
                            <form id="logout-form" action="{% url 'logout' %}" method="post" style="display: none;">
                                {% csrf_token %}
                            </form>
                        </ul>
                      </div>
                    </div>
                    <div class="profile-card-body">
                        <img src="{% if user.profileimage %}{{ user.profileimage.url }}{% else %}{% static 'image/user.png' %}{% endif %}" alt="Profile">
                        <div class="nickname"> {{ user.nickname|default:"ÎØ∏ÏÑ§Ï†ï" }}</div>
                        <div class="email">{{ user.email }}</div>
                    </div>
                    <hr class="divider">
                    <div class="profile-card-footer">
                        <a href="/privacy-policy/" class="footer-link">Í∞úÏù∏Ï†ïÎ≥¥Ï≤òÎ¶¨Î∞©Ïπ®</a>
                        <a href="/terms-of-service/" class="footer-link">Ïù¥Ïö©ÏïΩÍ¥Ä</a>
                    </div>
                  </div>
            </div>
        </div>
    </div>


    <div class="event-contents">
        <div class="centerSection expand-main">
            {% if calendars %}
                <!-- Îã¨Î†• Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏùÑ Í≤ΩÏö∞ -->
                <div id="calendar"></div>
            {% else %}
                <!-- Îã¨Î†• Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏùÑ Í≤ΩÏö∞ -->
                <div class="no-calendar">
                    <p>ÌòÑÏû¨ Ï∞∏Ïó¨ Ï§ëÏù∏ Ï∫òÎ¶∞ÎçîÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>
                    <a href="new/" class="btn">ÏÉà Ï∫òÎ¶∞Îçî ÎßåÎì§Í∏∞</a>
                </div>
            {% endif %}
        </div>
        <div class="right-section hidden-slide">
            <div class="custom-event-form-wrap">
                <form id="custom-event-form" class="custom-event-form">
                    {% csrf_token %}
                    <!-- Ï†úÎ™© -->
                    <div>
                        <input type="text" id="event-title" name="title" class="event-title" placeholder="Title">
                    </div>
                
                    <!-- ÏãúÏûëÏùº / Ï¢ÖÎ£åÏùº -->
                    <div class="date-section">
                        <div class="event-date">

                            <div class="start-date">
                                <div class="name-date">ÏãúÏûëÏùº</div>
                                <div class="date-input">
                                    <input type="text" id="start-date" name="sdate"
                                    placeholder="ÎÇ†Ïßú ÏÑ†ÌÉù"
                                    readonly>
                                </div>
                                <div class="time-input">
                                    <input type="time" id="start-time" name="stime">
                                </div>
                            </div>

                            <div class="end-date">
                                <div class="name-date">Ï¢ÖÎ£åÏùº</div>
                                <div class="date-input"> 
                                    <input type="text" id="end-date" name="edate"
                                    placeholder="ÎÇ†Ïßú ÏÑ†ÌÉù"
                                    readonly>
                                </div>
                                <div class="time-input">
                                    <input type="time" id="end-time" name="etime">
                                </div>
                            </div>
                        </div>

                        <!-- Ï¢ÖÏùº Ïó¨Î∂Ä -->
                        <div class="chekbox-group">
                            <div class="form-contents">
                                <input type="checkbox" id="all-day" name="isAllday" checked>
                                <label for="all-day">Ï¢ÖÏùº</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="option-section">
                        <!-- ÏÉâÏÉÅ ÏÑ†ÌÉù -->
                        <div class="event-option">
                            <i data-lucide="tag" class="icon"></i>
                            <select id="event-color-select" name="color" class="event-tag">
                                <option value="#000000">üñ§ Ï†úÌä∏ Î∏îÎûô</option>
                                <option value="#6366f1">üü£ ÌçºÌîå Î∏îÎ£®</option>
                                <option value="#f472b6">üå∏ ÌïëÌÅ¨ Î°úÏ¶à</option>
                                <option value="#34d399">üíö ÎØºÌä∏ Í∑∏Î¶∞</option>
                                <option value="#facc15">üíõ Î†àÎ™¨ ÏòêÎ°úÏö∞</option>
                                <option value="#60a5fa">üíô Ïä§Ïπ¥Ïù¥ Î∏îÎ£®</option>
                                <option value="#fb923c">üß° ÏΩîÎûÑ Ïò§Î†åÏßÄ</option>
                                <option value="#a78bfa">üíú ÎùºÎ≤§Îçî</option>
                              </select>
                        </div>

                        <div class="event-option">
                            <i data-lucide="circle-user-round" class="icon"></i>
                            <div id="participant-list" class="participant-list">
                                <!-- Í∏∞Î≥∏ Ï∞∏Ïó¨Ïûê Î™©Î°ù -->
                                <div class="participant" data-email="joonyoung@potato.co.kr">
                                    <img src="{% static 'image/user.png' %}" alt="Î∞ïÏ§ÄÏòÅ" class="participant-img">
                                </div>
                            </div>
                        </div>

                        <div class="calSelectContainer">
                            <i data-lucide="calendar" class="icon"></i>
                            <select name="calendar_id">
                                {% for calendar in calendars %}
                                    <option value="{{ calendar.id }}" {% if forloop.first %}selected{% endif %}>
                                        {{ calendar.calendar_name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>

                    </div>
                </form>
            </div>
            <div class="form-bottom-group">
                <button id="close-section-btn">
                    Ï∑®ÏÜå
                </button>
                <button id="save-section-btn">
                    Ï†ÄÏû•
                </button>
            </div>
        </div>
    </div>

    <!-- ÌîÑÎ°úÌïÑ ÏàòÏ†ï Î™®Îã¨ -->
    <div id="modalProfileEdit" class="modal">
        <div class="modal-content">
            <!--<span class="close">&times;</span>-->
            <h3>ÌîÑÎ°úÌïÑ ÏàòÏ†ï</h3>
            <!-- Ïó¨Í∏∞Ïóê ÌîÑÎ°úÌïÑ ÏàòÏ†ï Ìèº -->
            <form class="profile-form" id="profileForm" enctype="multipart/form-data">
                <!-- ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ -->
                <div class="profile-photo-container">
                    <img src="{% if user.profileimage %}{{ user.profileimage.url }}{% else %}{% static 'image/user.png' %}{% endif %}" 
                     alt="ÌîÑÎ°úÌïÑ ÏÇ¨ÏßÑ" 
                     class="profile-photo" 
                     id="currentProfilePhoto">

                    <label for="profilePhotoInput" class="edit-photo-btn" title="ÏÇ¨ÏßÑ Î≥ÄÍ≤Ω">
                        ‚úèÔ∏è
                    </label>
                    <input type="file" id="profilePhotoInput" accept="image/*" style="display: none;">
                </div>
        
                <!-- ÎãâÎÑ§ÏûÑ -->
                <div>
                    <label for="nickname">ÎãâÎÑ§ÏûÑ</label><br>
                    <input type="text" id="nickname" name="nickname" placeholder="ÌïÑÏàò ÏûÖÎ†•Í∞íÏûÖÎãàÎã§." value="{{ user.nickname|default:'' }}">
                </div>
        
                <!-- ÏÉùÎÖÑÏõîÏùº -->
                <div>
                    <label for="birthDate">ÏÉùÎÖÑÏõîÏùº</label><br>
                    <input type="text" id="birthDate" name="birthDate"
                    placeholder="ÎÇ†Ïßú ÏÑ†ÌÉù">
                </div>
        
                <!-- Ï†úÏ∂ú Î≤ÑÌäº -->
                <div class="modal-bottom-group">
                    <button id="close-modal-btn">
                        Ï∑®ÏÜå
                    </button>
                    <button id="save-modal-btn">
                        Ï†ÄÏû•
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ÏïåÎ¶º ÏÑ§Ï†ï Î™®Îã¨ -->
    <div id="modalNotification" class="modal">
        <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>ÏïåÎ¶º ÏÑ§Ï†ï</h2>
        <!-- ÏïåÎ¶º ÏÑ§Ï†ï ÎÇ¥Ïö© -->
        </div>
    </div>
    
    <!-- Í∞úÏù∏Ï†ïÎ≥¥ ÏÑ§Ï†ï Î™®Îã¨ -->
    <div id="modalPrivacy" class="modal">
        <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>Í∞úÏù∏Ï†ïÎ≥¥ ÏÑ§Ï†ï</h2>
        <!-- Í∞úÏù∏Ï†ïÎ≥¥ ÎÇ¥Ïö© -->
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
    <script src="{% static 'js/calendar.js' %}"></script>

    <script id="calendars_json" type="application/json">{{ calendars_json|safe }}</script>
    <script id="pendingcalendars_json" type="application/json">{{ pending_calendars_json|safe }}</script>

    <script id="holidays_json" type="application/json">{{ holidays_json|safe }}</script>

    <script id="events_json"   type="application/json">{{ events_json|safe }}</script>
    {{ block.super }}  <!-- base.htmlÏóêÏÑú Ï†ïÏùòÎêú Í∏∞Î≥∏ Ïä§ÌÅ¨Î¶ΩÌä∏ÎèÑ Ìò∏Ï∂ú -->
{% endblock %}